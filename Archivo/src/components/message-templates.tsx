"use client"

import { useState } from "react"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Copy, Mail, MessageSquare, Calendar, Bell, UserCheck, Home, CheckCircle2 } from "lucide-react"
import { useToast } from "@/hooks/use-toast"
import { useMobile } from "@/hooks/use-mobile"

interface MessageTemplate {
  id: string
  title: string
  body: string
  channel: "email" | "sms" | "whatsapp" | "all"
  tags: string[]
}

export function MessageTemplates() {
  const { toast } = useToast()
  const { isMobile } = useMobile()
  const [activeTab, setActiveTab] = useState("contacto-inicial")

  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text)
    toast({
      title: "Copiado al portapapeles",
      description: "El mensaje ha sido copiado correctamente",
    })
  }

  const messageTemplates: Record<string, MessageTemplate[]> = {
    "contacto-inicial": [
      {
        id: "primer-contacto-lead",
        title: "Respuesta a solicitud de informaci√≥n",
        body: "Hola [Nombre],\n\nGracias por tu inter√©s en la propiedad [T√≠tulo de Propiedad]. Mi nombre es [Nombre del Agente] y ser√© tu asesor inmobiliario personal.\n\nMe gustar√≠a conocer m√°s sobre lo que est√°s buscando para poder ayudarte mejor. ¬øTienes alguna preferencia espec√≠fica en cuanto a ubicaci√≥n, tama√±o o presupuesto?\n\nEstoy disponible para resolver cualquier duda que tengas sobre esta propiedad o mostrarte otras opciones similares que podr√≠an interesarte.\n\nPuedes contactarme directamente a este n√∫mero o agendar una llamada en el horario que te resulte m√°s conveniente.\n\nSaludos cordiales,\n[Nombre del Agente]\n[Tel√©fono]\n[Correo electr√≥nico]",
        channel: "all",
        tags: ["nuevo lead", "informaci√≥n", "presentaci√≥n"],
      },
      {
        id: "bienvenida-portal",
        title: "Bienvenida desde portal inmobiliario",
        body: "Hola [Nombre],\n\nHe recibido tu consulta desde Portal Inmobiliario sobre la propiedad [T√≠tulo/Direcci√≥n].\n\nSoy [Nombre del Agente] de [Nombre de la Inmobiliaria] y estar√© encantado/a de brindarte toda la informaci√≥n que necesites sobre esta propiedad.\n\n¬øTe gustar√≠a coordinar una visita para conocerla personalmente? Tengo disponibilidad esta semana y podemos adaptarnos a tu horario.\n\nQuedo atento a tus comentarios.\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "email",
        tags: ["portal inmobiliario", "bienvenida", "visita"],
      },
      {
        id: "contacto-whatsapp",
        title: "Primer contacto por WhatsApp",
        body: "Hola [Nombre], soy [Nombre del Agente] de [Inmobiliaria]. Recib√≠ tu consulta sobre la propiedad en [Direcci√≥n/Zona]. Esta propiedad cuenta con [caracter√≠sticas destacadas]. ¬øTe gustar√≠a recibir m√°s informaci√≥n o coordinar una visita? Estoy a tu disposici√≥n para resolver cualquier duda. üè†‚ú®",
        channel: "whatsapp",
        tags: ["whatsapp", "breve", "informal"],
      },
      {
        id: "respuesta-rapida-sms",
        title: "Respuesta r√°pida por SMS",
        body: "Hola [Nombre], gracias por tu inter√©s en la propiedad de [Direcci√≥n]. Soy [Nombre], tu asesor inmobiliario. ¬øPodemos hablar hoy para darte m√°s detalles? Ll√°mame al [Tel√©fono] o responde este mensaje para coordinar. [Nombre de la Inmobiliaria]",
        channel: "sms",
        tags: ["sms", "corto", "acci√≥n r√°pida"],
      },
    ],
    seguimiento: [
      {
        id: "seguimiento-post-visita",
        title: "Seguimiento despu√©s de visita",
        body: "Estimado/a [Nombre],\n\nEspero que est√©s bien. Quer√≠a agradecerte por tu visita a la propiedad en [Direcci√≥n] el pasado [D√≠a de la visita].\n\nMe gustar√≠a saber tus impresiones sobre la propiedad y si tienes alguna pregunta adicional que haya surgido despu√©s de la visita.\n\nSi est√°s interesado/a, podemos conversar sobre los siguientes pasos o, si esta propiedad no cumpli√≥ completamente con tus expectativas, puedo mostrarte otras opciones que podr√≠an ajustarse mejor a lo que buscas.\n\nQuedo atento a tus comentarios.\n\nSaludos cordiales,\n[Nombre del Agente]\n[Tel√©fono]",
        channel: "email",
        tags: ["post-visita", "feedback", "siguiente paso"],
      },
      {
        id: "seguimiento-sin-respuesta",
        title: "Seguimiento sin respuesta previa",
        body: "Hola [Nombre],\n\nEspero que te encuentres bien. Hace unos d√≠as te envi√© informaci√≥n sobre la propiedad en [Direcci√≥n/Zona] que consultaste, y quer√≠a saber si tuviste oportunidad de revisarla.\n\nSigo a tu disposici√≥n para resolver cualquier duda que tengas o para mostrarte la propiedad si est√°s interesado/a.\n\nTambi√©n quer√≠a comentarte que tenemos algunas propiedades nuevas que podr√≠an interesarte, basadas en tu b√∫squeda inicial.\n\n¬øTe gustar√≠a que te env√≠e esta informaci√≥n adicional?\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "all",
        tags: ["recordatorio", "sin respuesta", "nuevas opciones"],
      },
      {
        id: "seguimiento-whatsapp",
        title: "Seguimiento breve por WhatsApp",
        body: "Hola [Nombre], soy [Nombre del Agente] de [Inmobiliaria]. ¬øQu√© tal todo? Quer√≠a saber si has tenido tiempo de revisar la informaci√≥n que te envi√© sobre la propiedad en [Direcci√≥n]. Estoy disponible para resolver cualquier duda o mostrarte m√°s opciones si lo prefieres. ¬°Que tengas un excelente d√≠a! üëã",
        channel: "whatsapp",
        tags: ["whatsapp", "informal", "breve"],
      },
      {
        id: "seguimiento-interes",
        title: "Seguimiento a cliente interesado",
        body: "Estimado/a [Nombre],\n\nEspero que est√©s bien. Quer√≠a hacer un seguimiento sobre tu inter√©s en la propiedad [Direcci√≥n/Referencia] que vimos la semana pasada.\n\nComo comentamos, esta propiedad tiene bastante demanda y quer√≠a asegurarme de que tengas toda la informaci√≥n necesaria para tomar una decisi√≥n.\n\nSi est√°s considerando hacer una oferta, estar√© encantado/a de asesorarte sobre el proceso y ayudarte a preparar una propuesta competitiva.\n\n¬øTe gustar√≠a que agendemos una llamada para discutir los detalles?\n\nQuedo atento a tus comentarios.\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "email",
        tags: ["cliente interesado", "oferta", "asesoramiento"],
      },
    ],
    citas: [
      {
        id: "confirmacion-visita",
        title: "Confirmaci√≥n de visita",
        body: "Estimado/a [Nombre],\n\nConfirmo nuestra visita a la propiedad ubicada en [Direcci√≥n completa] para el d√≠a [Fecha] a las [Hora].\n\nNos encontraremos directamente en la propiedad. Te comparto la ubicaci√≥n exacta: [Link de Google Maps]\n\nAlgunos detalles pr√°cticos:\n- La visita durar√° aproximadamente 30-45 minutos\n- Hay estacionamiento disponible en [detalles de estacionamiento]\n- Te recomiendo llegar 5 minutos antes para comenzar puntualmente\n\nSi necesitas reagendar o tienes alguna pregunta antes de la visita, no dudes en contactarme.\n\n¬°Nos vemos pronto!\n\nSaludos cordiales,\n[Nombre del Agente]\n[Tel√©fono m√≥vil para contacto directo]",
        channel: "email",
        tags: ["confirmaci√≥n", "visita", "detalles pr√°cticos"],
      },
      {
        id: "recordatorio-visita",
        title: "Recordatorio de visita (d√≠a anterior)",
        body: "Hola [Nombre],\n\nEspero que est√©s bien. Te escribo para recordarte nuestra visita programada para ma√±ana [Fecha] a las [Hora] en la propiedad ubicada en [Direcci√≥n].\n\nEl pron√≥stico del tiempo indica [informaci√≥n del clima si es relevante], as√≠ que te recomiendo [sugerencia seg√∫n el clima].\n\nPor favor, conf√≠rmame si mantenemos la cita seg√∫n lo acordado o si necesitas hacer alg√∫n cambio.\n\n¬°Nos vemos ma√±ana!\n\nSaludos cordiales,\n[Nombre del Agente]\n[Tel√©fono]",
        channel: "all",
        tags: ["recordatorio", "visita", "confirmaci√≥n"],
      },
      {
        id: "recordatorio-whatsapp",
        title: "Recordatorio por WhatsApp (mismo d√≠a)",
        body: "Hola [Nombre], te recuerdo nuestra visita de hoy a las [Hora] en [Direcci√≥n]. Estar√© esper√°ndote en la entrada principal. Si necesitas indicaciones o tienes alg√∫n contratiempo, escr√≠beme o ll√°mame al [Tel√©fono]. ¬°Hasta pronto! üè†‚è∞",
        channel: "whatsapp",
        tags: ["recordatorio", "mismo d√≠a", "whatsapp"],
      },
      {
        id: "reagendamiento",
        title: "Propuesta de reagendamiento",
        body: "Estimado/a [Nombre],\n\nEntiendo que no podr√°s asistir a nuestra visita programada para [Fecha y hora original]. No hay problema, podemos reagendarla para un momento m√°s conveniente.\n\nTe propongo las siguientes alternativas:\n- [Fecha y hora opci√≥n 1]\n- [Fecha y hora opci√≥n 2]\n- [Fecha y hora opci√≥n 3]\n\nPor favor, ind√≠came cu√°l de estas opciones te funciona mejor o sugi√©reme otro horario que se adapte a tu agenda.\n\nQuedo atento a tu respuesta.\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "all",
        tags: ["reagendamiento", "opciones", "flexibilidad"],
      },
    ],
    actualizaciones: [
      {
        id: "actualizacion-precio",
        title: "Actualizaci√≥n de precio",
        body: "Estimado/a [Nombre],\n\nEspero que este mensaje te encuentre bien. Te escribo porque ha habido una actualizaci√≥n importante en la propiedad de [Direcci√≥n] que visitaste recientemente.\n\nEl propietario ha decidido ajustar el precio de venta de $[Precio anterior] a $[Precio nuevo], lo que representa una reducci√≥n del [X]%.\n\nDado el inter√©s que mostraste en esta propiedad, quer√≠a informarte de inmediato sobre esta oportunidad, ya que ahora podr√≠a ajustarse mejor a tu presupuesto.\n\nSi te interesa retomar la conversaci√≥n sobre esta propiedad con las nuevas condiciones, estar√© encantado/a de atenderte y resolver cualquier duda adicional.\n\nQuedo atento a tus comentarios.\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "email",
        tags: ["actualizaci√≥n", "precio", "oportunidad"],
      },
      {
        id: "nueva-propiedad",
        title: "Nueva propiedad seg√∫n intereses",
        body: "Hola [Nombre],\n\nEspero que est√©s bien. Te escribo porque acaba de ingresar a nuestro portafolio una propiedad que coincide con los criterios que me comentaste en nuestra √∫ltima conversaci√≥n.\n\nSe trata de un/a [tipo de propiedad] de [X] m¬≤ en [Zona/Barrio], con [N¬∞] dormitorios y [N¬∞] ba√±os, a un precio de $[Precio].\n\nAlgunas caracter√≠sticas destacadas:\n- [Caracter√≠stica destacada 1]\n- [Caracter√≠stica destacada 2]\n- [Caracter√≠stica destacada 3]\n\nAdjunto encontrar√°s algunas fotos preliminares. Esta propiedad a√∫n no est√° publicada en nuestro sitio web, por lo que tienes la oportunidad de visitarla antes que otros interesados.\n\n¬øTe gustar√≠a agendar una visita para conocerla?\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "email",
        tags: ["nueva propiedad", "exclusividad", "visita"],
      },
      {
        id: "actualizacion-estado",
        title: "Actualizaci√≥n de estado de propiedad",
        body: "Estimado/a [Nombre],\n\nTe escribo para informarte que la propiedad ubicada en [Direcci√≥n] que visitamos el [Fecha de visita] ha cambiado su estado a [Nuevo estado: Reservada/Con oferta/etc.].\n\nEsto significa que [explicaci√≥n breve de lo que implica este estado].\n\nSi a√∫n est√°s interesado/a en esta propiedad, te recomendar√≠a [acci√≥n recomendada seg√∫n el caso: actuar r√°pido/hacer una oferta competitiva/etc.].\n\nAlternativamente, si prefieres explorar otras opciones similares, tengo algunas propiedades que podr√≠an interesarte.\n\nQuedo atento a tus comentarios para asesorarte de la mejor manera posible.\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "all",
        tags: ["actualizaci√≥n", "estado", "urgencia"],
      },
      {
        id: "actualizacion-whatsapp",
        title: "Actualizaci√≥n r√°pida por WhatsApp",
        body: "Hola [Nombre], tengo novedades sobre la propiedad en [Direcci√≥n/Zona] que te interes√≥: [breve descripci√≥n de la actualizaci√≥n: baj√≥ de precio/se agregaron nuevas fotos/etc.]. ¬øTe gustar√≠a que te env√≠e los detalles actualizados? Estoy disponible si quieres conversar sobre esto. üè†üìä",
        channel: "whatsapp",
        tags: ["actualizaci√≥n", "whatsapp", "breve"],
      },
    ],
    cierre: [
      {
        id: "oferta-aceptada",
        title: "Confirmaci√≥n de oferta aceptada",
        body: "Estimado/a [Nombre],\n\n¬°Tengo excelentes noticias! Tu oferta por la propiedad ubicada en [Direcci√≥n] ha sido ACEPTADA por el propietario.\n\nFelicitaciones por este importante paso. Ahora comenzaremos con el proceso de [siguiente paso: firma de promesa/escrituraci√≥n/etc.].\n\nLos pr√≥ximos pasos ser√°n:\n\n1. [Descripci√≥n del primer paso]\n2. [Descripci√≥n del segundo paso]\n3. [Descripci√≥n del tercer paso]\n\nNecesitaremos que prepares la siguiente documentaci√≥n:\n- [Documento 1]\n- [Documento 2]\n- [Documento 3]\n\nPropongo que agendemos una reuni√≥n para el [fecha y hora sugerida] para revisar todos los detalles y resolver cualquier duda que tengas sobre el proceso.\n\n¬°Nuevamente felicitaciones por tu nueva propiedad!\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "email",
        tags: ["oferta aceptada", "felicitaci√≥n", "pr√≥ximos pasos"],
      },
      {
        id: "contraoferta",
        title: "Comunicaci√≥n de contraoferta",
        body: "Estimado/a [Nombre],\n\nEspero que est√©s bien. Te escribo respecto a la oferta que presentaste por la propiedad en [Direcci√≥n].\n\nEl propietario ha revisado tu propuesta y, aunque est√° interesado, ha presentado una contraoferta con las siguientes condiciones:\n\n- Precio: $[Monto contraoferta]\n- [Otra condici√≥n modificada]\n- [Otra condici√≥n modificada]\n\nEl resto de las condiciones se mantienen seg√∫n lo propuesto por ti.\n\nEl propietario est√° abierto a cerrar el trato con estas modificaciones y espera tu respuesta hasta el [Fecha l√≠mite].\n\nPor favor, hazme saber tu decisi√≥n o si te gustar√≠a que conversemos sobre estrategias de negociaci√≥n.\n\nQuedo atento a tus comentarios.\n\nSaludos cordiales,\n[Nombre del Agente]",
        channel: "email",
        tags: ["contraoferta", "negociaci√≥n", "decisi√≥n"],
      },
      {
        id: "agradecimiento-proceso",
        title: "Agradecimiento por proceso completado",
        body: "Estimado/a [Nombre],\n\n¬°Felicitaciones por la adquisici√≥n de tu nueva propiedad! Ha sido un placer acompa√±arte durante todo este proceso.\n\nQuiero agradecerte sinceramente por la confianza depositada en m√≠ y en [Nombre de la Inmobiliaria] para una decisi√≥n tan importante en tu vida.\n\nComo comentamos, seguir√© disponible para cualquier consulta que puedas tener sobre tu nueva propiedad o para asistirte en cualquier necesidad relacionada con ella en el futuro.\n\nTambi√©n quer√≠a mencionarte que gran parte de mi trabajo se basa en recomendaciones, por lo que si conoces a alguien que est√© buscando comprar, vender o arrendar una propiedad, te agradecer√≠a mucho tu referencia.\n\nTe deseo mucha felicidad en tu nuevo hogar.\n\nSaludos cordiales,\n[Nombre del Agente]\n[Tel√©fono]\n[Correo electr√≥nico]",
        channel: "email",
        tags: ["agradecimiento", "cierre", "referidos"],
      },
      {
        id: "cierre-whatsapp",
        title: "Confirmaci√≥n de cierre por WhatsApp",
        body: "¬°Excelentes noticias, [Nombre]! üéâ La oferta ha sido aceptada y estamos listos para avanzar con el proceso de [escrituraci√≥n/firma de promesa]. Te enviar√© por correo todos los detalles de los pr√≥ximos pasos. ¬°Felicitaciones por tu nueva propiedad! üè†üîë",
        channel: "whatsapp",
        tags: ["cierre", "celebraci√≥n", "whatsapp"],
      },
    ],
  }

  const getChannelIcon = (channel: string) => {
    switch (channel) {
      case "email":
        return <Mail className="h-4 w-4" />
      case "sms":
        return <MessageSquare className="h-4 w-4" />
      case "whatsapp":
        return <MessageSquare className="h-4 w-4 text-green-500" />
      default:
        return <Mail className="h-4 w-4" />
    }
  }

  const getTabIcon = (tab: string) => {
    switch (tab) {
      case "contacto-inicial":
        return <UserCheck className="h-4 w-4 mr-2" />
      case "seguimiento":
        return <Bell className="h-4 w-4 mr-2" />
      case "citas":
        return <Calendar className="h-4 w-4 mr-2" />
      case "actualizaciones":
        return <Home className="h-4 w-4 mr-2" />
      case "cierre":
        return <CheckCircle2 className="h-4 w-4 mr-2" />
      default:
        return null
    }
  }

  return (
    <div className="container mx-auto py-6">
      <Tabs defaultValue="contacto-inicial" value={activeTab} onValueChange={setActiveTab}>
        <TabsList className="mb-4 overflow-x-auto flex w-full justify-start sm:justify-center">
          <TabsTrigger value="contacto-inicial">
            {!isMobile && getTabIcon("contacto-inicial")}
            {isMobile ? "Inicial" : "Contacto Inicial"}
          </TabsTrigger>
          <TabsTrigger value="seguimiento">
            {!isMobile && getTabIcon("seguimiento")}
            Seguimiento
          </TabsTrigger>
          <TabsTrigger value="citas">
            {!isMobile && getTabIcon("citas")}
            Citas
          </TabsTrigger>
          <TabsTrigger value="actualizaciones">
            {!isMobile && getTabIcon("actualizaciones")}
            {isMobile ? "Updates" : "Actualizaciones"}
          </TabsTrigger>
          <TabsTrigger value="cierre">
            {!isMobile && getTabIcon("cierre")}
            Cierre
          </TabsTrigger>
        </TabsList>

        {Object.entries(messageTemplates).map(([category, templates]) => (
          <TabsContent key={category} value={category} className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {templates.map((template) => (
                <Card key={template.id}>
                  <CardHeader className="pb-2">
                    <div className="flex justify-between items-start">
                      <CardTitle className="text-lg">{template.title}</CardTitle>
                      <Badge variant="outline" className="flex items-center gap-1">
                        {getChannelIcon(template.channel)}
                        <span className="capitalize">{template.channel === "all" ? "Todos" : template.channel}</span>
                      </Badge>
                    </div>
                    <CardDescription>
                      {template.tags.map((tag) => (
                        <Badge key={tag} variant="secondary" className="mr-1 mb-1">
                          {tag}
                        </Badge>
                      ))}
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="bg-muted p-3 rounded-md text-sm whitespace-pre-wrap max-h-60 overflow-y-auto">
                      {template.body}
                    </div>
                  </CardContent>
                  <CardFooter>
                    <Button
                      variant="outline"
                      size="sm"
                      className="w-full"
                      onClick={() => copyToClipboard(template.body)}
                    >
                      <Copy className="h-4 w-4 mr-2" /> Copiar mensaje
                    </Button>
                  </CardFooter>
                </Card>
              ))}
            </div>
          </TabsContent>
        ))}
      </Tabs>
    </div>
  )
}
